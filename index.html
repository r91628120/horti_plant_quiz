<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />

<title>園藝丙級術科識別線上模擬測驗｜100題｜40分鐘｜Horti ID Quiz</title>
<meta name="description" content="園藝丙級術科識別線上模擬測驗：依題庫分為 8 類（果樹、蔬菜、水生、蔓性、草本、灌木、喬木、資材），依比例隨機出題共 100 題，每題 1 分、限時 40 分鐘，題型為圖片配合選項單選。" />
<meta name="keywords" content="園藝丙級, 術科, 植物識別, 模擬測驗, 園藝作物, 園藝題庫, 農業職能, 技能檢定" />
<meta name="robots" content="index,follow" />
<link rel="canonical" href="https://r91628120.github.io/horti_plant_quiz/" />

<meta property="og:type" content="website" />
<meta property="og:title" content="園藝丙級術科識別線上模擬測驗｜100題｜40分鐘" />
<meta property="og:description" content="8 類題庫按比例出題，共 100 題，每題 1 分、限時 40 分鐘，題型為圖片配合選項單選。支援手機／電腦作答。" />
<meta property="og:url" content="https://r91628120.github.io/horti_plant_quiz/" />
<meta property="og:site_name" content="Horti ID Quiz" />

<style>
  :root{
    --brand:#2563eb;
    --text:#0f172a;
    --muted:#475569;
    --bg:#f8fafc;
    --card:#ffffff;
    --ok:#16a34a;
    --err:#dc2626;
  }
  *{box-sizing:border-box}
  body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Noto Sans TC",Arial;
       color:var(--text);background:var(--bg)}
  .container{max-width:1100px;margin:0 auto;padding:24px}
  .card{background:var(--card);border-radius:14px;box-shadow:0 6px 24px rgba(2,6,23,.06);padding:24px}
  h1{font-size:32px;margin:0 0 16px}
  .muted{color:var(--muted)}
  .row{display:flex;gap:16px;flex-wrap:wrap;align-items:center}
  input[type=text]{width:100%;padding:14px 16px;border:2px solid #e2e8f0;border-radius:12px;font-size:18px}
  .btn{padding:14px 22px;border-radius:12px;border:none;background:var(--brand);color:#fff;font-weight:700;
       cursor:pointer;font-size:18px;box-shadow:0 6px 18px rgba(37,99,235,.25)}
  .btn.secondary{background:#0ea5e9}
  .btn.ghost{background:#e2e8f0;color:#111827}
  .badge{display:inline-block;padding:4px 10px;border-radius:9999px;background:#e2e8f0;color:#111827;font-size:14px}
  .note{background:#f1f5f9;padding:12px 14px;border-radius:10px}
  .grid{display:grid;gap:18px}
  .grid-2{grid-template-columns:1fr 1fr}
  .hide{display:none}
  .titleBar{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
  .counter{font-weight:700}
  .progress{height:8px;background:#e2e8f0;border-radius:9999px;overflow:hidden}
  .progress > div{height:100%;background:var(--brand);width:0%;}
  .imgWrap{border:3px solid #ef4444;border-radius:10px;overflow:hidden;max-height:520px;display:flex;justify-content:center}
  .imgWrap img{max-width:100%;height:auto;display:block}
  .opt{display:flex;align-items:center;gap:10px;border:2px solid #e2e8f0;border-radius:12px;padding:12px 14px;cursor:pointer}
  .opt:hover{background:#f8fafc}
  .opt input{transform:scale(1.2)}
  .opt-label{font-weight:700;margin-right:4px}
  .navRow{display:flex;gap:12px;margin-top:12px}
  .numberPad{display:flex;gap:8px;flex-wrap:wrap;margin-top:14px}
  .numberPad button{padding:8px 12px;border:1px solid #cbd5e1;background:#fff;border-radius:8px;cursor:pointer}
  .resultTable{width:100%;border-collapse:collapse}
  .resultTable th,.resultTable td{padding:10px;border-bottom:1px solid #e2e8f0}
  .ok{color:var(--ok);font-weight:700}
  .err{color:var(--err);font-weight:700}
  footer{color:var(--muted);text-align:center;margin:24px 0}
  @media (max-width:900px){
    .grid-2{grid-template-columns:1fr}
  }
</style>
</head>
<body>
<div class="container">

  <!-- A. 首頁 -->
  <section id="page-home" class="card">
    <h1>園藝丙級術科識別線上模擬測驗</h1>

    <div class="note muted" style="margin-bottom:12px">
      <div><strong>資料來源：</strong>勞動部勞動力發展署技能檢定中心。本網站圖片僅供教育與非營利用途，著作權歸原權利人所有，<strong>嚴禁未經授權之商業使用</strong>。</div>
    </div>

    <div class="note" style="margin-bottom:16px">
      <strong>測驗說明：</strong>本試題共測試 <strong>100 題</strong>，每題 <strong>1 分</strong>，總分 <strong>100 分</strong>，考試時間 <strong>40 分鐘</strong>。題型為單選題，需依試題圖片配合選項點選，正確點選者始給分，題目可前後閱視作答。
    </div>

    <div class="grid grid-2">
      <div>
        <label class="muted">姓名 / 代號</label>
        <input id="input-name" type="text" placeholder="請輸入姓名或代號">
      </div>
      <div>
        <div class="muted">版本：<span id="ver-badge" class="badge">載入中…</span></div>
        <div class="muted" style="margin-top:8px">目前累計測驗人數：<span id="people" class="counter">0</span> 人（本機）</div>
        <div class="muted" style="margin-top:4px">題庫：<span id="poolHint" class="badge">載入中…</span>（共 8 類）</div>
      </div>
    </div>

    <div class="row" style="margin-top:18px">
      <button class="btn" id="btn-start">▶ 開始測驗（100 題）</button>
      <button class="btn secondary" id="btn-quick">⚡ 快速體驗（10 題）</button>
    </div>
  </section>

  <!-- B. 作答頁 -->
  <section id="page-exam" class="card hide">
    <div class="titleBar">
      <div class="row">
        <div class="badge">考生：<span id="info-who">-</span></div>
        <div class="badge">題數：<span id="info-total">0</span></div>
        <div class="badge">倒數：<span id="info-time">--:--</span></div>
      </div>
      <div class="progress" style="width:40%"><div id="progress-bar"></div></div>
    </div>

    <h2 style="margin-top:6px">第 <span id="q-idx">1</span> / <span id="q-total">0</span> 題</h2>

    <div class="imgWrap" style="margin:10px 0 16px">
      <img id="q-img" alt="題目圖片" src="">
    </div>

    <div id="options" class="grid"></div>

    <div class="navRow">
      <button class="btn ghost" id="btn-prev">← 上一題</button>
      <button class="btn ghost" id="btn-next">下一題 →</button>
      <button class="btn" id="btn-submit">交卷</button>
    </div>

    <div class="muted" style="margin-top:12px">題目導覽</div>
    <div id="pager" class="numberPad"></div>
  </section>

  <!-- C. 結果頁 -->
  <section id="page-result" class="card hide">
    <h2>測驗結果</h2>
    <div class="note" style="margin-bottom:12px">
      姓名 / 代號：<strong id="r-name">-</strong>　
      題數：<strong id="r-count">0</strong>　
      得分：<strong id="r-score">0</strong>　
      版本：<span id="r-ver" class="badge">-</span>
    </div>

    <div class="grid">
      <table class="resultTable">
        <thead><tr>
          <th>#</th><th>題圖</th><th>你的答案</th><th>正確答案</th><th>判定</th>
        </tr></thead>
        <tbody id="r-rows"></tbody>
      </table>
    </div>

    <div class="row" style="margin-top:16px">
      <button class="btn ghost" id="btn-home">回首頁</button>
      <button class="btn" id="btn-retry">再測一次</button>
    </div>
  </section>

  <footer>© 2025 Horti 凡事皆正面 Quiz · 僅供教學示範（支援 <code>questions.json</code> 類別題庫）</footer>
</div>

<script>
/* ================= 基本與資料 ================= */
const categoryRules100 = {
  "fruit": 20,
  "vegetables": 20,
  "aquatic plants": 4,
  "vine plants": 6,
  "herbaceous plants": 20,
  "shrub": 10,
  "trees": 10,
  "materials": 10
};
const QUICK_TOTAL = 10;
const QUICK_TIME_MIN = 8;     // 快速體驗 10 題 → 8 分鐘
const FULL_TIME_MIN  = 40;    // 正式 100 題 → 40 分鐘

let JSON_VERSION = "local";
let ALL = {};                 // {category: [ {name, image}, ... ]}
let EXAM = [];                // 組卷後題目
let ANSW = [];                // 使用者選項 index（0..3），未作答為 -1
let WHO  = "";
let TIMER = null;
let TOTAL_SECONDS = 0;
let CUR = 0;
let isQuick = false;

const elHome   = document.getElementById('page-home');
const elExam   = document.getElementById('page-exam');
const elResult = document.getElementById('page-result');

/* ============== UI 工具 ============== */
function show(id){
  for (const sec of [elHome, elExam, elResult]) sec.classList.add('hide');
  document.getElementById(id).classList.remove('hide');
}
function shuffle(arr){
  for (let i=arr.length-1;i>0;i--){
    const j = Math.floor(Math.random()*(i+1));
    [arr[i],arr[j]] = [arr[j],arr[i]];
  }
}
function pickRandom(arr,n){
  const copy = [...arr];
  const out=[];
  for (let i=0;i<n && copy.length>0;i++){
    const idx = Math.floor(Math.random()*copy.length);
    out.push(copy.splice(idx,1)[0]);
  }
  return out;
}

/* ============== 題庫載入 ============== */
async function loadQuestions(){
  const r = await fetch('questions.json',{cache:'no-store'});
  const data = await r.json();
  JSON_VERSION = data.version || JSON_VERSION;
  ALL = data.categories || {};
  // 顯示首頁資訊
  document.getElementById('ver-badge').textContent = 'ver ' + JSON_VERSION;
  const cats = Object.keys(ALL);
  document.getElementById('poolHint').textContent = (cats.length ? cats.join('、') : '無') + '（共 ' + cats.length + ' 類）';
}

/* ============== 組卷（依 8 類比例） ============== */
function buildExam(total){
  // 依目標總題數（100 或 10）縮放每類數量
  const rule = {};
  const sum = Object.values(categoryRules100).reduce((a,b)=>a+b,0); // 100
  for (const [cat, count] of Object.entries(categoryRules100)){
    rule[cat] = Math.round(count / sum * total);
  }
  // 若四捨五入造成總數不等於 total，做微調
  let diff = total - Object.values(rule).reduce((a,b)=>a+b,0);
  while(diff !== 0){
    for (const cat of Object.keys(rule)){
      if (diff === 0) break;
      rule[cat] += (diff>0?1:-1);
      diff += (diff>0?-1:1);
    }
  }

  // 收集題目
  const paper = [];
  for (const [cat, count] of Object.entries(rule)){
    const pool = ALL[cat] || [];
    if (pool.length === 0) continue;
    const take = Math.min(count, pool.length);
    const chosen = pickRandom(pool, take);
    // 補上類別資訊
    chosen.forEach(q => paper.push({...q, category:cat}));
  }
  // 有可能不足，從所有類再補
  if (paper.length < total){
    const allFlat = Object.values(ALL).flat();
    const need = total - paper.length;
    const extra = pickRandom(allFlat, need);
    extra.forEach(q => paper.push({...q, category: q.category || 'misc'}));
  }
  shuffle(paper);
  // 轉為考試題型（加上選項）
  const nameSet = new Set();
  for (const arr of Object.values(ALL)) arr.forEach(x => nameSet.add(x.name));
  const allNames = [...nameSet];

  const out = paper.map(item => makeQuestion(item, allNames));
  return out.slice(0, total);
}

/* 依題目建立 1 正確 + 3 錯誤的選項 */
function makeQuestion(correctItem, allNames){
  const correctName = correctItem.name;
  const wrongPool = allNames.filter(n => n !== correctName);
  shuffle(wrongPool);
  const distractors = wrongPool.slice(0,3);
  const ops = [correctName, ...distractors];
  shuffle(ops);
  const correctIndex = ops.indexOf(correctName);
  return {
    image: correctItem.image,
    answer: correctName,
    options: ops,             // ['名1','名2','名3','名4']
    correctIndex,             // 0..3
    picked: -1                // 使用者作答
  };
}

/* ============== 考試控制 ============== */
function startExam(quick=false){
  WHO = (document.getElementById('input-name').value || '').trim() || '匿名';
  if (!Object.keys(ALL).length){
    alert('尚未載入題庫，請稍候或檢查 questions.json');
    return;
  }
  isQuick = quick;
  const total = quick ? QUICK_TOTAL : 100;
  EXAM = buildExam(total);
  ANSW = new Array(EXAM.length).fill(-1);
  CUR = 0;

  // 計時
  clearInterval(TIMER);
  TOTAL_SECONDS = (quick?QUICK_TIME_MIN:FULL_TIME_MIN) * 60;
  tick();
  TIMER = setInterval(tick, 1000);

  // 人數 +1（本機）
  const k = 'horti_exam_people';
  const now = +(localStorage.getItem(k) || 0) + 1;
  localStorage.setItem(k, now);

  // 畫面
  document.getElementById('info-who').textContent = WHO;
  document.getElementById('info-total').textContent = EXAM.length;
  document.getElementById('q-total').textContent = EXAM.length;
  buildPager();
  renderQuestion();
  show('page-exam');
}
function tick(){
  const m = Math.floor(TOTAL_SECONDS/60);
  const s = TOTAL_SECONDS%60;
  document.getElementById('info-time').textContent = String(m).padStart(2,'0')+':'+String(s).padStart(2,'0');
  const done = ANSW.filter(x=>x>=0).length;
  document.getElementById('progress-bar').style.width = (done/EXAM.length*100).toFixed(1)+'%';
  if (TOTAL_SECONDS<=0){
    clearInterval(TIMER);
    submitExam();
  }
  TOTAL_SECONDS--;
}

/* 逐題渲染 */
function renderQuestion(){
  const q = EXAM[CUR];
  document.getElementById('q-idx').textContent = CUR+1;
  document.getElementById('q-img').src = q.image;
  const wrap = document.getElementById('options');
  wrap.innerHTML = '';
  const letters = ['A','B','C','D'];
  q.options.forEach((opt, i)=>{
    const div = document.createElement('label');
    div.className = 'opt';
    div.innerHTML = `
      <input type="radio" name="opt" ${q.picked===i?'checked':''}/>
      <span class="opt-label">${letters[i]}.</span>
      <span>${opt}</span>`;
    div.addEventListener('click', ()=>{
      q.picked = i;
      ANSW[CUR] = i;
      updatePagerButton(CUR);
    });
    wrap.appendChild(div);
  });
}

/* 題號導覽 */
function buildPager(){
  const p = document.getElementById('pager');
  p.innerHTML='';
  for (let i=0;i<EXAM.length;i++){
    const b = document.createElement('button');
    b.textContent = (i+1);
    b.id = 'pg-'+i;
    b.addEventListener('click',()=>{CUR=i;renderQuestion();});
    p.appendChild(b);
  }
}
function updatePagerButton(i){
  const b = document.getElementById('pg-'+i);
  if (!b) return;
  b.style.background = (ANSW[i] >= 0 ? '#dcfce7' : '#fff');
}

/* 交卷 */
function submitExam(){
  clearInterval(TIMER);
  let score = 0;
  const rows = [];
  const letters = ['A','B','C','D'];

  EXAM.forEach((q, i)=>{
    const ok = q.picked === q.correctIndex;
    if (ok) score += 1;
    rows.push({
      i: i+1,
      img: q.image,
      mine: q.picked>=0 ? `${letters[q.picked]}. ${q.options[q.picked]}` : '(未作答)',
      ans: `${letters[q.correctIndex]}. ${q.options[q.correctIndex]}`,
      pass: ok
    });
  });

  // 畫結果
  document.getElementById('r-name').textContent = WHO;
  document.getElementById('r-count').textContent = EXAM.length;
  document.getElementById('r-score').textContent = score;
  document.getElementById('r-ver').textContent = 'ver ' + JSON_VERSION;

  const tb = document.getElementById('r-rows');
  tb.innerHTML='';
  rows.forEach(r=>{
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${r.i}</td>
      <td><img src="${r.img}" alt="" style="max-width:120px;border-radius:8px"></td>
      <td>${r.mine}</td>
      <td>${r.ans}</td>
      <td class="${r.pass?'ok':'err'}">${r.pass?'✔ 正確':'✘ 錯誤'}</td>`;
    tb.appendChild(tr);
  });

  show('page-result');
}

/* ============== 綁定事件 & 初始 ============== */
document.getElementById('btn-prev').addEventListener('click', ()=>{
  if (CUR>0){CUR--;renderQuestion();}
});
document.getElementById('btn-next').addEventListener('click', ()=>{
  if (CUR<EXAM.length-1){CUR++;renderQuestion();}
});
document.getElementById('btn-submit').addEventListener('click', submitExam);

document.getElementById('btn-home').addEventListener('click', ()=>show('page-home'));
document.getElementById('btn-retry').addEventListener('click', ()=>{
  show('page-home');
});

document.getElementById('btn-start').addEventListener('click', ()=>startExam(false));
document.getElementById('btn-quick').addEventListener('click', ()=>startExam(true));

/* 累計測驗人數（本機） */
function updatePeople(){
  const n = +(localStorage.getItem('horti_exam_people') || 0);
  document.getElementById('people').textContent = n;
}

/* 啟動 */
(async function init(){
  updatePeople();
  await loadQuestions();
})();
</script>
</body>
</html>
